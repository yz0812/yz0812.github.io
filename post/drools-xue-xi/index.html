<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
<title>Drools 快速指南 - yz</title>
<meta name="description" content="少年拥有了时间,时间带走了年少" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

<link type="text/css" rel="stylesheet" href="https://yz0812.github.io/styles/main.css" media="screen" />
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" />
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" />
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css" integrity="sha512-FwY1WVsm4UQgrOXt6kaQ53w83cOHa8fSvjFn/BvVOCYVPmkSR39k/xnU+8hht3zW6JL1TBd4C/aVQIAV58Cg6A==" crossorigin="anonymous" /> -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/atom-one-dark.min.css" integrity="sha512-Jlyabam8ztU2kOGN19fSzv1Go9nt9A43UA6vhmL1MPsQMeoPZd+p7pbmegAtyl8kulna0Cqwb7Pgj4adGTLCXA==" crossorigin="anonymous" />
<script type="text/javascript" src="https://yz0812.github.io/media/scripts/jquery.js"></script>
<!-- <script type="text/javascript" src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js" integrity="sha512-tHQeqtcNWlZtEh8As/4MmZ5qpy0wj04svWFK7MIzLmUVIzaHXS8eod9OmHxyBL1UET5Rchvw7Ih4ZDv5JojZww==" crossorigin="anonymous"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-7JNCPNX91Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'G-7JNCPNX91Z');
</script>


<script>
  hljs.initHighlightingOnLoad();
</script>

</head>

<body>
  <div class="layout">
    <div class="layout-header">

	<div class="layout-header-main">
		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">

					<div class="navbar">

						<div class="logo">
							<a href="https://yz0812.github.io">
								<img class="logo" src="https://yz0812.github.io/media/images/site_avatar.png?v=1770995982259"
									alt="">
							</a>
						</div>

						<div class="menu d-md-inline-block d-none">
							<ul class="layout-navigation-list">
								
								<li class="layout-navigation-item"><a title="归档"
										href="/archives">归档</a>
								</li>
								
								<li class="layout-navigation-item"><a title="标签"
										href="/tags">标签</a>
								</li>
								
								<li class="layout-navigation-item"><a title="关于"
										href="/post/about">关于</a>
								</li>
								
							</ul>
						</div>

						

						<div class="nav d-md-none d-inline-block">
							<div class="trigger">
								<i class="fa fa-bars layout-btn-toggle" aria-hidden="true"></i>
							</div>
						</div>

					</div>

				</div>
			</div>




		</div>
	</div>

</div>
    <div class="layout-collapse d-md-none">
	<div class="layout-collapse-main">
		<ul class="layout-collapse-list">
			
			<li class="layout-collapse-item"><a title="归档" href="/archives">归档</a></li>
			
			<li class="layout-collapse-item"><a title="标签" href="/tags">标签</a></li>
			
			<li class="layout-collapse-item"><a title="关于" href="/post/about">关于</a></li>
			

		</ul>
	</div>
</div>

    <div class="layout-content">
      <div class="layout-content-main">
        <div class="container">
          <div class="row justify-content-lg-center">
            <div class="col-12 col-lg-9">
              <div class="layout-post">
                <div class="layout-post-body">
                  <div class="row">

                    <div class="col-12 col-lg-10">
                      <div class="layout-post-main m-right m-md-right">
                        <div class="layout-post-header">
                          <h1 class="layout-post-title">Drools 快速指南</h1>
                          <div class="layout-post-meta">
                            <div class="item">
                               <a href="https://yz0812.github.io/tag/EXPhuDLUo/" class="post--keyword"
                                data-title="教程" data-type="post_tag" data-term-id="39">教程</a>
                              
                            </div>
                            <div class="item">
                              <span>2022-08-29</span>
                            </div>
                          </div>
                        </div>
                        <div class="layout-post-content">
                          <div class="layout-post-item">
                            
                            <p class="with-img"><img src="https://fastly.jsdelivr.net/gh/yz0812/mypic@master/img/65.jpg"
                                class="attachment-full size-full wp-post-image" alt="Drools 快速指南" /></p>
                            
                            <h1 id="drools使用教程">Drools使用教程</h1>
<p><strong><span style="color:#ee3f4d">注意：SpringBoot版本和Drools版本直接的兼容问题。</span></strong></p>
<p><strong>举例：某电商平台促销活动</strong></p>
<p>活动规则是根据⽤户购买订单的⾦额给⽤户送相应的积分，购买的越多送的积分越多，⽤户可以使⽤积分来兑换相应的商品，我们这次活动的⼒度很⼤，肯定会吸引很多的⽤户参加，产品经理⼩王兴⾼采烈唾液横⻜的对⼩明讲到。</p>
<p>⽤户购买的⾦额和对应送多少积分的规则如下:</p>
<table>
<thead>
<tr>
<th style="text-align:center">规则编号</th>
<th>名称</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td>充值100元以内</td>
<td style="text-align:center">不加分</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td>充值100元-500元</td>
<td style="text-align:center">100分</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td>充值500元-1000元</td>
<td style="text-align:center">500分</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td>充值1000元以上</td>
<td style="text-align:center">1000分</td>
</tr>
</tbody>
</table>
<p>⼩明⼀看，这需求果然简单呀，作为⼀个⼯作了两三年的程序员来讲，这不就是⼩case，半天搞</p>
<p>定，送积分的⼼代码如下：</p>
<pre><code class="language-java">   public void execute() throws Exception {
        List&lt;Order&gt; orderList = getInitData();
        for (int i = 0; i &lt; orderList.size(); i++) {
            Order order = orderList.get(i);
            if (order.getAmout() &lt;= 100) {
                order.setScore(0);
                addScore(order);
            } else if (order.getAmout() &gt; 100 &amp;&amp; order.getAmout() &lt;= 500) {
                order.setScore(100);
                addScore(order);
            } else if (order.getAmout() &gt; 500 &amp;&amp; order.getAmout() &lt;= 1000) {
                order.setScore(500);
                addScore(order);
            } else {
                order.setScore(1000);
                addScore(order);
            }
        }
    }
</code></pre>
<p>正当⼩明得意洋洋的打了个最新版本投产上线之后，产品经理⼩王说积分规则层次太少了，由以前的4组变成8组，⼩明此刻的⼼情：kao …</p>
<p>⼩明想这样下去⾮得被他们弄死，必须要找找有什么技术可以将活动规则和代码解耦，不管规则如何变化，执⾏端不⽤动。⼩明搜了半天还真有这样的东⻄，那就是规则引擎，那么规则引擎到</p>
<p>底是什么东⻄呢？我们来看看。</p>
<h2 id="1-规则引擎">1. 规则引擎</h2>
<p>规则引擎：全称为业务规则管理系统，英⽂名为BRMS(即Business Rule Management</p>
<p>System)。<span style="color:#ffd111">规则引擎的主要思想是将应⽤程序中的业务决策部分分离出来，并使⽤预定义的语义模块编写业务决策（业务规则），由⽤户或开发者在需要时进⾏配置、管理。</span> 需要注意的是规则引擎并不是⼀个具体的技术框架，⽽是指的⼀类系统，即业务规则管理系统。 ⽬前市⾯上具体的规则引擎产品有：drools、VisualRules、iLog等，<span style="color:#ffd111">使⽤最为⼴泛并且开源的是Drools。</span>  规则引擎实现了将业务决策从应⽤程序代码中分离出来，接收数据输⼊，解释业务规则，并根据业务规则做出业务决策。规则引擎其实就是⼀个输⼊输出平台。</p>
<p>规则引擎主要应⽤场景</p>
<p>对于⼀些存在⽐较复杂的业务规则并且业务规则会频繁变动的系统⽐较适合使⽤规则引擎，如下：</p>
<p>1、⻛险控制系统----⻛险贷款、⻛险评估</p>
<p>2、反欺诈项⽬----银⾏贷款、征信验证</p>
<p>3、决策平台系统----财务计算</p>
<p>4、促销平台系统----满减、打折、加价购</p>
<h2 id="2-drools介绍">2. Drools介绍</h2>
<p>drools是⼀款由JBoss组织提供的基于Java语⾔开发的开源规则引擎，可以将复杂且多变的业务规则从硬编码中解放出来，以规则脚本的形式存放在⽂件或特定的存储介质中(例如存放在数据库中)，使得业务规则的变更不需要修改项⽬代码、不⽤重启服务器就可以在线上环境⽴即⽣效。</p>
<p>drools官⽹地址 ：<a href="https://drools.org/">https://drools.org/</a></p>
<p>drools源码下载地址 ：<a href="https://github.com/kiegroup/drools">https://github.com/kiegroup/drools</a></p>
<p>● 使⽤规则引擎能够解决什么问题？ 针对复杂的业务规则代码处理，往往存在⼀下问题：</p>
<p>1、硬编码实现业务规则难以维护；</p>
<p>2、硬编码实现业务规则难以应对变化；</p>
<p>3、业务规则发⽣变化需要修改代码，重启服务后才能⽣效； 于是规则引擎Drools便诞⽣在项⽬</p>
<p>中。。。</p>
<p>● 使⽤规则引擎的优势如下：</p>
<p>1、业务规则与系统代码分离，实现业务规则的集中管理</p>
<p>2、在不重启服务的情况下可随时对业务规则进⾏扩展和维护</p>
<p>3、可以动态修改业务规则，从⽽快速响应需求变更</p>
<p>4、规则引擎是相对独⽴的，只关⼼业务规则，使得业务分析⼈员也可以参与编辑、维护系统的业</p>
<p>务规则</p>
<p>5、减少了硬编码业务规则的成本和⻛险</p>
<p>6、使⽤规则引擎提供的规则编辑⼯具，使复杂的业务规则实现变得的简单</p>
<p>drools API开发步骤如下：</p>
<ol>
<li>
<p>获取KieServices</p>
</li>
<li>
<p>获取KieContainer</p>
</li>
<li>
<p>KieSession</p>
</li>
<li>
<p>Insert fact</p>
</li>
<li>
<p>触发规则</p>
</li>
<li>
<p>关闭KieSession</p>
</li>
</ol>
<h2 id="3-demo">3. Demo</h2>
<h3 id="31-业务场景说明">3.1 业务场景说明</h3>
<table>
<thead>
<tr>
<th style="text-align:center">规则编号</th>
<th>名称</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td>充值100元以内</td>
<td style="text-align:center">不加分</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td>充值100元-500元</td>
<td style="text-align:center">100分</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td>充值500元-1000元</td>
<td style="text-align:center">500分</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td>充值1000元以上</td>
<td style="text-align:center">1000分</td>
</tr>
</tbody>
</table>
<h3 id="32-导包">3.2 导包</h3>
<pre><code class="language-xml">        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.12&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.drools&lt;/groupId&gt;
            &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
            &lt;version&gt;7.73.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.drools&lt;/groupId&gt;
            &lt;artifactId&gt;drools-mvel&lt;/artifactId&gt;
            &lt;version&gt;7.73.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre>
<h3 id="33-kmodulexml配置文件">3.3 kmodule.xml配置⽂件</h3>
<p>根据drools要求创建resources/META-INF/kmodule.xml配置⽂件</p>
<p>需要有⼀个配置⽂件告诉代码规则⽂件drl在哪⾥，在drools中这个⽂件就是kmodule.xml，放置到resources/META-INF⽬录下。</p>
<pre><code class="language-xml">&lt;kmodule xmlns=&quot;http://www.drools.org/xsd/kmodule&quot;&gt;
    &lt;!--
    name:指定kbase的名称，可以任意，但是需要唯一
    packages:指定规则文件的目录，需要根据实际情况填写，否则无法加载到规则文件
    default:指定当前kbase是否为默认
    --&gt;
    &lt;kbase name=&quot;myKbase1&quot; packages=&quot;drools.rules&quot; default=&quot;true&quot;&gt;
        &lt;!--
        name:指定ksession名称，可以任意，但是需要唯一
        default:指定当前session是否为默认
        --&gt;
        &lt;ksession name=&quot;ksession-rule&quot; default=&quot;true&quot;/&gt;
    &lt;/kbase&gt;
&lt;/kmodule&gt;
</code></pre>
<p>注意：上⾯配置⽂件的名称和位置都是固定写法，不能更改</p>
<p>Kmodule 中可以包含⼀个到多个 kbase,分别对应 drl 的规则⽂件。Kbase 需要⼀个唯⼀的 name,可以取任意字符串。packages 为drl⽂件所在resource⽬录下的路径。注意区分drl⽂件中的package与此处的package不⼀定相同。多个包⽤逗号分隔。默认情况下会扫描 resources⽬录下 所有(包含⼦⽬录)规则⽂件。kbase的default属性,标示当前KieBase是不是默认的,如果是默认的则不⽤名称就可以查找到该KieBase,但每个 module 最多只能有⼀个默认 KieBase。kbase 下⾯可以有⼀个或多个 ksession, ksession 的 name 属性必须设置,且必须唯⼀。</p>
<h3 id="34-创建实体类order">3.4 创建实体类Order</h3>
<pre><code class="language-java">@Data
@AllArgsConstructor
@NoArgsConstructor
public class Order {
    private int amout;
    private int score;
}
</code></pre>
<h3 id="35-创建规则文件resourcesdroolsrulesscore-rulesdrl">3.5 创建规则⽂件resources/drools/rules/score-rules.drl</h3>
<pre><code class="language-java">package drools.rules

import com.example.drools.entity.Order

// 规则1 100元以下不加分
rule &quot;score_1&quot;
when
$s : Order(amout &lt;= 100)
then
 $s.setScore(0);
 System.out.println(&quot;成功匹配到规则1： 100元以下，不加分&quot;);
end

// 规则2 100元-500元 加100分
rule &quot;score_2&quot;
when
$s : Order(amout &gt; 100 &amp;&amp; amout &lt;= 500)
then
 $s.setScore(100);
 System.out.println(&quot;成功匹配到规则2：100元-500元 加100分&quot;);
end

// 规则3 500元-1000元 加500分
rule &quot;score_3&quot;
when
$s : Order(amout &gt; 500 &amp;&amp; amout &lt;= 1000)
then
 $s.setScore(500);
 System.out.println(&quot;成功匹配到规则3：500元-1000元 加500分&quot;);
end

// 规则3 500元-1000元 加500分
rule &quot;score_4&quot;
when
$s : Order(amout &gt; 1000)
then
 $s.setScore(1000);
 System.out.println(&quot;成功匹配到规则4：1000元 以上 加1000分&quot;);
end
</code></pre>
<h3 id="36-编写单元测试">3.6 编写单元测试</h3>
<pre><code class="language-java">    /**
     * @description 积分测试
     * @author yz
     * @date 2022/08/29
     **/
    @Test
    public void integralTest() {
        KieServices kieServices = KieServices.Factory.get();
        KieContainer kieContainer = kieServices.getKieClasspathContainer();
        //会话对象，用于和规则引擎对象
        KieSession kieSession = kieContainer.newKieSession();
        //构造订单对象，设置订单金额，由规则引擎计算获得积分
        Order order = new Order(200, 0);
        //将数据交给规则引擎，由规则引擎计算获取积分
        kieSession.insert(order);
        //激活规则引擎，如果匹配成功则执⾏规则
        kieSession.fireAllRules();
        //关闭会话
        kieSession.dispose();
        //打印结果;
        System.out.println(&quot;订单提交之后积分：&quot; + order.getScore());
    }
</code></pre>
<p>执行结果：</p>
<pre><code class="language-log">2022-08-29 18:36:40.691  INFO 26040 --- [           main] o.d.c.kie.builder.impl.KieContainerImpl  : Start creation of KieBase: defaultKieBase
2022-08-29 18:36:40.694  INFO 26040 --- [           main] o.d.c.kie.builder.impl.KieContainerImpl  : End creation of KieBase: defaultKieBase
成功匹配到规则2：100元-500元 加100分
订单提交之后积分：100
</code></pre>
<h2 id="4-drools基础语法">4. Drools基础语法</h2>
<p><strong>drl是Drools Rule Language的缩写。在规则⽂件中编写具体的规则内容。</strong></p>
<p>⼀套完整的规则⽂件内容构成如下：</p>
<ul>
<li>package：包名，package对应的不⼀定是真正的⽬录，可以任意写com.abc，同⼀个包下的drl⽂</li>
</ul>
<p>件可以相互访问</p>
<ul>
<li>
<p>import：⽤于导⼊类或者静态⽅法</p>
</li>
<li>
<p>global：全局变量</p>
</li>
<li>
<p>function：⾃定义函数</p>
</li>
<li>
<p>query：查询</p>
</li>
<li>
<p>rule end：规则体</p>
</li>
</ul>
<p><strong>规则体语法结构</strong></p>
<p>⼀个规则通常包括三个部分：属性部分（attribute） 、条件部分（LHS）和结果部分（RHS）</p>
<pre><code class="language-java">    rule &quot;ruleName&quot; //rule关键字，表示规则开始，参span数为规则的唯⼀名称
    attributes //规则属性，是rule与when之间的参数，为可选项
    when //关键字，后⾯是规则的条件部分
        LHS //Left Hand Side，是规则的条件部分
    then //后⾯跟规则的结果部分 
        RHS //是规则的结果或⾏为
    end //表示⼀个规则的结束
</code></pre>
<p><strong>LHS</strong></p>
<p><strong>(Left Hand Side)：是规则的条件部分的通⽤名称。它由零个或多个条件元素组成。如果LHS为空，则它将被视为始终为true的条件元素。 （左⼿边）</strong></p>
<p><span style="color:#12a182"> LHS部分由⼀个或者多个条件组成，条件⼜称为pattern.     <span></p>
<p>其中绑定变量名可以省略，通常绑定变量名的命名⼀般建议以$开始。如果定义了绑定变量名，就可以</p>
<p>在规则体的RHS部分使⽤此绑定变量名来操作相应的Fact对象。Field约束部分是需要返回true或者false</p>
<p>的0个或多个表达式。</p>
<pre><code class="language-java">     //规则1：100元以下, 不加分
     rule &quot;score_1&quot;
     when
     // ⼯作内存中必须存在Order这种类型的Fact对象-----类型约束 
     // Fact对象的amout属性值必须⼩于等于100------属性约束 
     $s : Order(amout &lt;= 100) 
     then
     $s.setScore(0); 
     System.out.println(&quot;成功匹配到规则1：100元以下, 不加分 &quot;); 
     end
</code></pre>
<p>如果 LHS 部分为空的话，那么引擎会⾃动添加⼀个 eval(true)的条件，由于该条件总是返回 true，所以 LHS 为空的规则总是返回 true</p>
<p><strong>约束连接</strong></p>
<p>在 LHS 当中，可以包含 0~n 个条件，多个pattern之间可以采⽤“&amp;&amp;” （and） 、 “||”(or)和“,”(and)来实现，也可以不写，默认连接为and。</p>
<pre><code class="language-java">//规则2：100元-500元 加100分
rule &quot;score_2&quot;
when
$s : Order(amout &gt; 100 &amp;&amp; amout &lt;= 500)
then
$s.setScore(100);
System.out.println(&quot;成功匹配到规则2：100元-500元 加100分 &quot;);
end
</code></pre>
<p><strong>⽐较操作符</strong></p>
<p>在 Drools当中共提供了⼗⼆种类型的⽐较操作符， 分别是： &gt;、 &gt;=、 &lt;、 &lt;=、 = =、 !=、</p>
<p>contains、 not contains、memberof、not memberof、matches、not matches；在这⼗⼆种类型的</p>
<p>⽐较操作符当中，前六个是⽐较常⻅也是⽤的⽐较多的⽐较操作符</p>
<table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于等于</td>
</tr>
<tr>
<td style="text-align:center">==</td>
<td style="text-align:center">等于</td>
</tr>
<tr>
<td style="text-align:center">!=</td>
<td style="text-align:center">不等于</td>
</tr>
<tr>
<td style="text-align:center">contains</td>
<td style="text-align:center">检查一个Fact对象的某个属性值是否包含一个指定的对象值</td>
</tr>
<tr>
<td style="text-align:center">not contains</td>
<td style="text-align:center">检查一个Fact对象的某个属性值是否不包含一个指定的对象值</td>
</tr>
<tr>
<td style="text-align:center">memberOf</td>
<td style="text-align:center">判断一个Fact对象的某个属性是否在一个或多个集合中</td>
</tr>
<tr>
<td style="text-align:center">not memberOf</td>
<td style="text-align:center">判断一个Fact对象的某个属性是否不在一个或多个集合中</td>
</tr>
<tr>
<td style="text-align:center">matches</td>
<td style="text-align:center">判断一个Fact对象的属性是否与提供的标准的Java正则表达式进行匹配</td>
</tr>
<tr>
<td style="text-align:center">not matches</td>
<td style="text-align:center">判断一个Fact对象的属性是否不与提供的标准的Java正则表达式进行匹配</td>
</tr>
</tbody>
</table>
<p><strong>示例代码</strong></p>
<pre><code class="language-java">
//测试contains规则
rule &quot;rule&quot;
when
$ordre:Order();
$customer:Customer(orderList contains $ordre);
then
System.out.println(&quot;测试contains规则触发：&quot;+$customer.getName());
end

//测试not contains规则
rule &quot;rule2&quot;
when
$order:Order();
$customer:Customer(orderList not contains $order);
then
System.out.println(&quot;测试not contains规则触发：&quot;+$customer.getName());
end

//测试⽐较操作符matches
rule &quot;rule3&quot;
when
Customer(name matches &quot;张.*&quot;)
then
System.out.println(&quot;测试⽐较操作符matches触发...&quot;);
end

//测试⽐较操作符not matches
rule &quot;rule4&quot;
when
Customer(name not matches &quot;张.*&quot;)
then
System.out.println(&quot;测试⽐较操作符not matches触发...&quot;);
end
</code></pre>
<h2 id="5结果部分">5.结果部分</h2>
<h3 id="51-insert">5.1 insert</h3>
<p>函数insert的作用与我们在Java类当中调用StatefulKnowledgeSession对象的insert方法的作用相同，都是用来将一个 Fact 对象插入到当前的 Working Memory 当中</p>
<p>需注意：<span style="color:#ee3f4d">一旦调用insert 宏函数，那么 Drools 会重新与所有的规则再重新匹配一次， 对于没有设置no-loop 属性为 true 的规则，如果条件满足，不管其之前是否执行过都会再执行一次，这个特性不仅存在于 insert 宏函数上，后面介绍的 update、retract 宏函数同样具有该特性，所以在某些情况下因考虑不周调用insert、update 或 retract 容易发生死循环</span></p>
<p>示例：</p>
<pre><code class="language-java">
//Drools提供的内置方法insert
rule &quot;rule5&quot;
when
eval(true); //默认成立
then
Customer cus=new Customer();
cus.setName(&quot;张三&quot;);
insert(cus);
System.out.println(&quot;测试Drools提供的内置方法insert 触发...&quot;);
end
  
rule &quot;rule6&quot;
when
$customer:Customer(name ==&quot;张三&quot;);
then
System.out.println(&quot;测试Drools提供的内置方法insert 触发...&quot;+$customer.getName());
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">    @Test
    public void insert() {
        KieServices kieServices = KieServices.Factory.get();
        KieContainer kieContainer = kieServices.getKieClasspathContainer();
        //会话对象,用于和规则引擎交互
        KieSession kieSession = kieContainer.newKieSession();
        //激活规则引擎，如果匹配成功则执行规则
        kieSession.fireAllRules();
        //关闭会话
        kieSession.dispose();
    }
</code></pre>
<p>insertLogical</p>
<p>insertLogical 作用与 insert 类似，它的作用也是将一个 Fact 对象插入到当前的 Working Memroy 当中</p>
<h3 id="52-update">5.2 update</h3>
<p>update函数意义与其名称一样， 用来实现对当前Working Memory当中的 Fact进行更新，用来告诉当前的 Working Memory 该 Fact 对象已经发生了变化。</p>
<pre><code class="language-java">rule &quot;rule7&quot;
//no-loop true
when
$customer:Customer(name ==&quot;李四&quot;);
then
$customer.setName(&quot;张三&quot;);
update($customer);
System.out.println(&quot;测试Drools提供的内置⽅法update触发...&quot;);
end

rule &quot;rule8&quot;
when
$customer:Customer(name ==&quot;张三&quot;);
then
System.out.println(&quot;测试Drools提供的内置⽅法update触发...&quot;+$customer.getName());
end
</code></pre>
<p>测试</p>
<pre><code class="language-java">    @Test
    public void update() {
        KieHelper kieHelper = new KieHelper();
        // 获取指定的drl文件
        Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/customer-rules.drl&quot;, &quot;UTF-8&quot;);
        kieHelper.addResource(resource, ResourceType.DRL);
        KieBase kieBase = kieHelper.build();
        //会话对象，用于和规则引擎对象
        KieSession kieSession = kieBase.newKieSession();
        Customer customer = new Customer();
        customer.setName(&quot;李四&quot;);
        kieSession.insert(customer);
        //激活规则引擎，如果匹配成功则执行规则
        kieSession.fireAllRules();
        //关闭会话
        kieSession.dispose();
    }
</code></pre>
<h3 id="53-retract">5.3 retract</h3>
<p>retract用来将 Working Memory 当中某个 Fact 对象从 Working Memory 当中删除</p>
<pre><code class="language-java">
//Drools提供的内置方法retract
rule &quot;rule9&quot;
when
$customer:Customer(name ==&quot;李四&quot;);
then
retract($customer);
System.out.println(&quot;测试Drools提供的内置方法retract 触发...&quot;);
end
rule &quot;rule10&quot;
when
$customer:Customer();
then
System.out.println(&quot;测试Drools提供的内置方法retract 触发...&quot;+$customer.getName());
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void retract() {
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/customer-rules.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    //会话对象，用于和规则引擎对象
    KieSession kieSession = kieBase.newKieSession();
    Customer customer = new Customer();
    customer.setName(&quot;李四&quot;);
    kieSession.insert(customer);
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules();
    //关闭会话
    kieSession.dispose();
}
</code></pre>
<h2 id="6属性部分">6.属性部分</h2>
<table>
<thead>
<tr>
<th>属性名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>salience</td>
<td>指定规则执行优先级</td>
</tr>
<tr>
<td>dialect</td>
<td>指定规则使用的语言类型，取值为java和mvel</td>
</tr>
<tr>
<td>enabled</td>
<td>指定规则是否启用</td>
</tr>
<tr>
<td>date-effective</td>
<td>指定规则生效时间</td>
</tr>
<tr>
<td>date-expires</td>
<td>指定规则失效时间</td>
</tr>
<tr>
<td>activation-group</td>
<td>激活分组，具有相同分组名称的规则只能有一个规则触发</td>
</tr>
<tr>
<td>agenda-group</td>
<td>议程分组，只有获取焦点的组中的规则才有可能触发</td>
</tr>
<tr>
<td>timer</td>
<td>定时器，指定规则触发的时间</td>
</tr>
<tr>
<td>auto-focus</td>
<td>自动获取焦点，一般结合agenda-group一起使用</td>
</tr>
<tr>
<td>no-loop</td>
<td>防止死循环</td>
</tr>
</tbody>
</table>
<h3 id="61-salience">6.1 salience</h3>
<p>作用是用来设置规则执行的优先级，salience 属性的值是一个数字，数字越大执行优先级越高。默认情况下，规则的 salience 默认值为 0。如果不设置salience属性，规则体的执行顺序为由上到下。</p>
<p>示例：</p>
<pre><code class="language-java">rule &quot;attributes_rule1&quot;
salience 1
when
eval(true)
then
System.out.println(&quot;rule1....&quot;);
end
rule &quot;attributes_rule2&quot;
salience 2
when
eval(true)
then
System.out.println(&quot;rule2....&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void salience() {
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules();
    //关闭会话
    kieSession.dispose();
}
</code></pre>
<p>运行结果:</p>
<pre><code class="language-log">rule2....
rule1....
</code></pre>
<h3 id="62-no-loop">6.2 no-loop</h3>
<p>作用是用来控制已经执行过的规则在条件再次满足时是否再次执行。no-loop 属性的值是一个布尔型，默认情况下规则的 no-loop属性的值为 false，如果 no-loop 属性值为 true，那么就表示该规则只会被引擎检查一次，</p>
<p>如果满足条件就执行规则的 RHS 部分，如果引擎内部因为对 Fact 更新引起引擎再次启动检查规则，那么它会忽略掉所有的 no-loop 属性设置为 true 的规则。</p>
<pre><code class="language-java">//测试no-loop
rule &quot;attributes_rule3&quot;
salience 1
no-loop true
when
$customer:Customer(name==&quot;张三&quot;)
then
update($customer);
System.out.println(&quot;customer name:&quot;+$customer.getName());
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void noLoop() {
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    Customer customer = new Customer();
    customer.setName(&quot;张三&quot;);
    kieSession.insert(customer);
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules(new RuleNameEqualsAgendaFilter(&quot;attributes_rule3&quot;));
    //关闭会话
    kieSession.dispose();
}
</code></pre>
<p>结果:</p>
<pre><code class="language-log">customer name:张三
</code></pre>
<h3 id="63-date-effective">6.3 date-effective</h3>
<p>作用是用来控制规则只有在到达后才会触发，在规则运行时，引擎会自动拿当前操作系统的时候与 date-effective 设置的时间值进行比对， 只有当系统时间&gt;=date-effective 设置的时间值时，规则才会触发执行，否则执行将不执行。在没有设置该属性的情况下，规则随时可以触发，没有这种限制。</p>
<p>date-effective 的值为一个日期型的字符串，默认情况下，date-effective 可接受的日期格式为“dd-MMM-yyyy”</p>
<p>在实际使用的过程当中，如果您不想用这种时间的格式，那么可以在调用的 Java 代码中通过使用System.setProperty(String key,String value)方法来修改默认的时间格式</p>
<p>在java文件中添加此条命令: System.setProperty(&quot;drools.dateformat&quot;,&quot;yyyy-MM-dd&quot;);</p>
<pre><code class="language-java">//测试date-effective 系统时间&gt;date-expires=true
rule &quot;attributes_rule4&quot;
date-effective &quot;2021-11-20&quot;
//当前日期不小于2021-11-25时可以执行
when
eval(true);
then
System.out.println(&quot;attributes_rule4 is execution!&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void dateEffective() {
    System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules(new RuleNameEqualsAgendaFilter(&quot;attributes_rule4&quot;));
    //关闭会话
    kieSession.dispose();
}
</code></pre>
<h3 id="64-date-expires">6.4 date-expires</h3>
<pre><code class="language-java">//测试date-expires 系统时间&lt;date-expires=true
rule &quot;attributes_rule5&quot;
date-expires &quot;2022-11-20&quot;
//当前日期不小于2021-11-25时可以执行
when
eval(true);
then
System.out.println(&quot;attributes_rule5 is execution!&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void dateExpires() {
    System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules(new RuleNameEqualsAgendaFilter(&quot;attributes_rule5&quot;));
    //关闭会话
    kieSession.dispose();
}
</code></pre>
<h3 id="65-enabled">6.5 enabled</h3>
<p>作用是用来定义一个规则是否可用的。该属性的值是一个布尔值，默认该属性的值为 true，表示规则是可用的。设置其 enabled 属性值为 false，那么引擎就不会执行该规则</p>
<pre><code class="language-java">//测试enabled
rule &quot;attributes_rule6&quot;
enabled false
when
eval(true);
then
System.out.println(&quot;attributes_rule6 is execution!&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java"> @Test
    public void enabled() {
        System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
        KieHelper kieHelper = new KieHelper();
        // 获取指定的drl文件
        Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
        kieHelper.addResource(resource, ResourceType.DRL);
        KieBase kieBase = kieHelper.build();
        KieSession kieSession = kieBase.newKieSession();
        // 只匹配规则名称是已 activation_group_ 开头的规则，忽略其余的规则
        kieSession.fireAllRules(new RuleNameEqualsAgendaFilter(&quot;attributes_rule6&quot;));
        //关闭会话
        kieSession.dispose();
    }
</code></pre>
<h3 id="66-dialect">6.6 dialect</h3>
<p>作用是用来定义规则当中要使用的语言类型，目前支持两种类型的语言：mvel 和 java，默认情况下，如果没有手工设置规则的 dialect，那么使用的 java 语言</p>
<h3 id="67-activation-group">6.7 activation-group</h3>
<p>作用是将若干个规则划分成一个组，用一个字符串来给这个组命名，这样在执行的时候，具有相同 activation-group 属性的规则中只要有一个会被执行，其它的规则都将不再执行。</p>
<p>也就是说，在一组具有相同 activation-group 属性的规则当中，只有一个规则会被执行，其它规则都将不会被执行。当然对于具有相同 activation-group 属性的规则当中究竟哪一个会先执行，则可以用类似 salience 之类属性来实现。</p>
<pre><code class="language-java">//测试activation-group
rule &quot;activation_group_7&quot;
activation-group &quot;test&quot;
when
eval(true)
then
System.out.println(&quot;activation_group_7 execute...&quot;);
end

rule &quot;activation_group_8&quot;
activation-group &quot;test&quot;
when
eval(true)
then
System.out.println(&quot;activation_group_8 execute...&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">    @Test
    public void activationGroup() {
        System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
        KieHelper kieHelper = new KieHelper();
        // 获取指定的drl文件
        Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
        kieHelper.addResource(resource, ResourceType.DRL);
        KieBase kieBase = kieHelper.build();
        KieSession kieSession = kieBase.newKieSession();
        // 只匹配规则名称是已 activation_group_ 开头的规则，忽略其余的规则
        kieSession.fireAllRules(new RuleNameStartsWithAgendaFilter(&quot;activation_group_&quot;));
        //关闭会话
        kieSession.dispose();
    }
</code></pre>
<h3 id="68-agenda-group">6.8 agenda-group</h3>
<p>作用是agenda-group 属性的值也是一个字符串，通过这个字符串，可以将规则分为若干个Agenda Group，默认情况下，引擎在调用这些设置了 agenda-group 属性的规则的时候需要显示的指定某个 Agenda Group 得到 Focus （焦点） ， 这样位于该 Agenda Group 当中的规则才会触发执行，否则将不执行。</p>
<pre><code class="language-java">//测试agenda-group
rule &quot;agenda_group_9&quot;
agenda-group &quot;001&quot;
when
eval(true)
then
System.out.println(&quot;agenda-group_9 execute...&quot;);
end

rule &quot;agenda_group_10&quot;
agenda-group &quot;002&quot;
when
eval(true)
then
System.out.println(&quot;agenda-group_10 execute...&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void agendaGroup() {
    System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    kieSession.getAgenda().getAgendaGroup(&quot;002&quot;).setFocus();
    // 只匹配规则名称是已 activation_group_ 开头的规则，忽略其余的规则
    kieSession.fireAllRules(new RuleNameStartsWithAgendaFilter(&quot;agenda_group_&quot;));
    //关闭会话
    kieSession.dispose();
}
</code></pre>
<h3 id="69-auto-focus">6.9 auto-focus</h3>
<p>作用是用来在已设置了 agenda-group 的规则上设置该规则是否可以自动独取 Focus，如果该属性设置为 true，那么在引擎执行时，就不需要显示的为某个 Agenda Group 设置 Focus，否则需要。</p>
<pre><code class="language-java">
rule &quot;agenda_group_11&quot;
agenda-group &quot;003&quot;
auto-focus true
when
eval(true)
then
System.out.println(&quot;auto-focus_11 execute...&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void autoFocus() {
    System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    // 只匹配规则名称是已 activation_group_ 开头的规则，忽略其余的规则
    kieSession.fireAllRules(new RuleNameStartsWithAgendaFilter(&quot;agenda_group_&quot;));
    //关闭会话
    kieSession.dispose();
}
</code></pre>
<h3 id="610-timer">6.10 timer</h3>
<p>timer属性可以通过定时器的方式指定规则执行的时间，使用方式有两种：</p>
<p>方式一：timer (int: ?)</p>
<p>此种方式遵循java.util.Timer对象的使用方式，第一个参数表示几秒后执行，第二个参数表示每隔几秒执行一次，第二个参数为可选。</p>
<p>方式二：timer(cron: )</p>
<p>此种方式使用标准的unix cron表达式的使用方式来定义规则执行的时间。</p>
<p>示例：</p>
<pre><code class="language-java">package drools.rules

import java.text.SimpleDateFormat
import java.util.Date

/*
此规则文件用于测试timer属性
*/
rule &quot;rule_timer_1&quot;
timer (5s 2s) //含义：5秒后触发，然后每隔2秒触发一次
when
then
System.out.println(&quot;规则rule_timer_1触发，触发时间为：&quot; +
new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Date()));
end
rule &quot;rule_timer_2&quot;
timer (cron:0/1 * * * * ?) //含义：每隔1秒触发一次
when
then
System.out.println(&quot;规则rule_timer_2触发，触发时间为：&quot; +
new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Date()));
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void timer() throws InterruptedException {
    //设置修改默认的时间格式
    System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/attribute-rule-timer.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    new Thread(() -&gt; {
        //启动规则引擎进行规则匹配，直到调用halt方法才结束规则引擎
        kieSession.fireUntilHalt();
    }).start();
    Thread.sleep(10000);
    //结束规则引擎
    kieSession.halt();
    kieSession.dispose();
}
</code></pre>
<p>注意：<span style="color:#ee3f4d">单元测试的代码和以前的有所不同，因为我们规则文件中使用到了timer进行定时执行，需要程序能够持续一段时间才能够看到定时器触发的效果。</span></p>
<h2 id="7-drools高级语法">7.  Drools高级语法</h2>
<table>
<thead>
<tr>
<th style="text-align:center">关键字</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">package</td>
<td style="text-align:center">包名，只限于逻辑上的管理，同一个包名下的查询或者函数可以直接调用</td>
</tr>
<tr>
<td style="text-align:center">import</td>
<td style="text-align:center">用于导入类或者静态方法</td>
</tr>
<tr>
<td style="text-align:center">global</td>
<td style="text-align:center">全局变量</td>
</tr>
<tr>
<td style="text-align:center">function</td>
<td style="text-align:center">自定义函数</td>
</tr>
<tr>
<td style="text-align:center">query</td>
<td style="text-align:center">查询</td>
</tr>
<tr>
<td style="text-align:center">rule end</td>
<td style="text-align:center">规则体</td>
</tr>
</tbody>
</table>
<h3 id="71-global全局变量">7.1 global全局变量</h3>
<p>全局变量，一般用作执行规则后的结果数据返回或对具体某个服务调用等，如一个电子邮件服务的实例，</p>
<p>在调用规则引擎的集成代码中，获取emailService对象，然后将其设置在工作内存中。</p>
<p>语法结构为：global 对象类型 对象名称</p>
<p>示例：</p>
<pre><code class="language-java">package drools.rules

global java.util.List myGlobalList;//如果在规则文件中使用了全局变量，那么必须在规则引擎中设置全局变量值
rule &quot;global_rule1&quot;
when
eval( true )
then
myGlobalList.add( &quot;Hello World&quot; );//
System.out.println(&quot;global_rule1 is execution...&quot;);
end
rule &quot;global_rule2&quot;
when
eval( true )
then
System.out.println(&quot;myGlobalList集合的元素个数:&quot;+myGlobalList.size());
System.out.println(&quot;global_rule2 is execution...&quot;);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void global() {
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/globa-ruls.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    List list = new ArrayList();
    //设置全局变量，名称和类型必须和规则文件中定义的全局变量名称对应
    kieSession.setGlobal(&quot;myGlobalList&quot;, list);
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules();
    kieSession.dispose();
    System.out.println(&quot;list.size():&quot; + list.size());
}
</code></pre>
<h3 id="72-query查询">7.2 query查询</h3>
<p>query语法提供了一种查询working memory中符合约束条件的FACT对象的简单方法。它仅包含规则文件中的LHS部分，不用指定“when”和“then”部分。Query有一个可选参数集合，每一个参数都有可选的类型。如果没有指定类型，则默认为Object类型。引擎会尝试强转为需要的类型。对于KieBase来说，query的名字是全局性的，因此不要向同一RuleBase 的不同包添加相同名称的query。</p>
<p>使用ksession.getQueryResults(“name”)方法可以获得查询的结果，其中name为query的名称，方法的返回结果一个列表，从中可以获取匹配查询到的对象。</p>
<pre><code class="language-java">package drools.rules
import com.example.drools.entity.Person
//不带参数的查询
//当前query用于查询Working Memory中age&gt;30的Person对象
query &quot;query-1&quot;
$person : Person(age &gt; 30)
end
//带有参数的查询
//当前query用于查询Working Memory中age&gt;30同时name需要和传递的参数name相同的Person对象
query &quot;query-2&quot;(String nameParam)
$person : Person(age &gt; 30,name == nameParam)
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void query() throws InterruptedException {
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/query-ruls.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    Person p1 = new Person();
    p1.setName(&quot;JACK1&quot;);
    p1.setAge(29);
    Person p2 = new Person();
    p2.setAge(40);
    p2.setName(&quot;JACK2&quot;);
    kieSession.insert(p1);
    kieSession.insert(p2);
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules();
    //通过规则过滤器实现只执行指定规则
    //kieSession.fireAllRules(new RuleNameEqualsAgendaFilter(&quot;rule5&quot;));
    QueryResults results = kieSession.getQueryResults(&quot;query-1&quot;);
    System.out.println(&quot;results size is &quot; + results.size());
    for (QueryResultsRow row : results) {
        Person person = (Person) row.get(&quot;$person&quot;);
        System.out.println(&quot;Person from WM, age : &quot; + person.getAge());
    }
    System.out.println(&quot;-----------------------&quot;);
    QueryResults results2 = kieSession.getQueryResults(&quot;query-2&quot;, &quot;JACK1&quot;);
    for (QueryResultsRow row : results2) {
        Person person = (Person) row.get(&quot;$person&quot;);
        System.out.println(person);
    }
    kieSession.dispose();
}
</code></pre>
<h3 id="73-function函数">7.3 function函数</h3>
<p>在规则中可以通过函数来做一些通用的逻辑,就相当于java类中的方法一样。函数的返回类型与参数类型与java的规则一样</p>
<pre><code class="language-java">package drools.rules
import com.example.drools.entity.Person

function String format(String name) {
return &quot;hello &quot; + name;
}
//测试函数
rule &quot;function_rule&quot;
when
$person:Person(name!=null&amp;&amp;age&gt;30)
then
//调用上面定义的函数
String ret = format($person.getName());
System.out.println(ret);
end
</code></pre>
<p>测试:</p>
<pre><code class="language-java">@Test
public void function() {
    KieHelper kieHelper = new KieHelper();
    // 获取指定的drl文件
    Resource resource = ResourceFactory.newClassPathResource(&quot;drools/rules/function-ruls.drl&quot;, &quot;UTF-8&quot;);
    kieHelper.addResource(resource, ResourceType.DRL);
    KieBase kieBase = kieHelper.build();
    KieSession kieSession = kieBase.newKieSession();
    Person p1 = new Person();
    p1.setName(&quot;JACK1&quot;);
    p1.setAge(29);
    Person p2 = new Person();
    p2.setAge(40);
    p2.setName(&quot;JACK2&quot;);
    kieSession.insert(p1);
    kieSession.insert(p2);
    //激活规则引擎，如果匹配成功则执行规则
    kieSession.fireAllRules();
    kieSession.dispose();
}
</code></pre>
<h2 id="8spring-boot整合drools">8.Spring Boot整合Drools</h2>
<p>**第一步：创建maven工程并配置pom.xml **</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.7.3&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;Drools&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;Drools&lt;/name&gt;
    &lt;description&gt;Drools&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.12&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.drools&lt;/groupId&gt;
            &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
            &lt;version&gt;7.73.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.drools&lt;/groupId&gt;
            &lt;artifactId&gt;drools-mvel&lt;/artifactId&gt;
            &lt;version&gt;7.73.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.kie&lt;/groupId&gt;
            &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
            &lt;version&gt;7.73.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.kie&lt;/groupId&gt;
            &lt;artifactId&gt;kie-spring&lt;/artifactId&gt;
            &lt;version&gt;7.73.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre>
<p><strong>第二步：创建resources/META-INF/kmodule.xml配置⽂件</strong></p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;kmodule xmlns=&quot;http://www.drools.org/xsd/kmodule&quot;&gt;
    &lt;!--
    name:指定kbase的名称，可以任意，但是需要唯一
    packages:指定规则文件的目录，需要根据实际情况填写，否则无法加载到规则文件
    default:指定当前kbase是否为默认
    --&gt;
    &lt;kbase name=&quot;myKbase1&quot; packages=&quot;drools.rules&quot; default=&quot;true&quot;&gt;
        &lt;!--
        name:指定ksession名称，可以任意，但是需要唯一
        default:指定当前session是否为默认
        --&gt;
        &lt;ksession name=&quot;ksession-rule&quot; default=&quot;true&quot;/&gt;
    &lt;/kbase&gt;
&lt;/kmodule&gt;
</code></pre>
<p><strong>第三步：创建/resources/application.yml文件</strong></p>
<pre><code class="language-yaml">server:
  port: 8088
spring:
  application:
    name: spring-boot-drools
</code></pre>
<p>**第四步：创建规则文件/resources/drools/rules/score-rules.drl **</p>
<pre><code class="language-java">package drools.rules

import com.example.drools.entity.Order

// 规则1 100元以下不加分
rule &quot;score_1&quot;
when
$s : Order(amout &lt;= 100)
then
 $s.setScore(0);
 System.out.println(&quot;成功匹配到规则1： 100元以下，不加分&quot;);
end

// 规则2 100元-500元 加100分
rule &quot;score_2&quot;
when
$s : Order(amout &gt; 100 &amp;&amp; amout &lt;= 500)
then
 $s.setScore(100);
 System.out.println(&quot;成功匹配到规则2：100元-500元 加100分&quot;);
end

// 规则3 500元-1000元 加500分
rule &quot;score_3&quot;
when
$s : Order(amout &gt; 500 &amp;&amp; amout &lt;= 1000)
then
 $s.setScore(500);
 System.out.println(&quot;成功匹配到规则3：500元-1000元 加500分&quot;);
end

// 规则3 500元-1000元 加500分
rule &quot;score_4&quot;
when
$s : Order(amout &gt; 1000)
then
 $s.setScore(1000);
 System.out.println(&quot;成功匹配到规则4：1000元 以上 加1000分&quot;);
end
</code></pre>
<p><strong>第五步：编写配置类DroolsConfig</strong></p>
<pre><code class="language-java">package com.example.drools.config;

import org.kie.api.KieBase;
import org.kie.api.KieServices;
import org.kie.api.builder.KieBuilder;
import org.kie.api.builder.KieFileSystem;
import org.kie.api.builder.KieRepository;
import org.kie.api.runtime.KieContainer;
import org.kie.internal.io.ResourceFactory;
import org.kie.spring.KModuleBeanFactoryPostProcessor;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.core.io.support.ResourcePatternResolver;
import org.springframework.core.io.Resource;

import java.io.IOException;

/**
 * @author yz
 * @description drools配置
 * @date 2022/08/29
 **/


@Configuration
public class DroolsConfig {
    //指定规则文件存放的目录
    private static final String RULES_PATH = &quot;drools/rules/&quot;;
    private final KieServices kieServices = KieServices.Factory.get();

    @Bean
    @ConditionalOnMissingBean
    public KieFileSystem kieFileSystem() throws IOException {
        System.setProperty(&quot;drools.dateformat&quot;, &quot;yyyy-MM-dd&quot;);
        KieFileSystem kieFileSystem = kieServices.newKieFileSystem();
        ResourcePatternResolver resourcePatternResolver = new PathMatchingResourcePatternResolver();
        Resource[] files = resourcePatternResolver.getResources(&quot;classpath*:&quot; + RULES_PATH + &quot;*.*&quot;);
        String path;
        for (Resource file : files) {
            path = RULES_PATH + file.getFilename();
            kieFileSystem.write(ResourceFactory.newClassPathResource(path, &quot;UTF-8&quot;));
        }
        return kieFileSystem;
    }

    @Bean
    @ConditionalOnMissingBean
    public KieContainer kieContainer() throws IOException {
        KieRepository kieRepository = kieServices.getRepository();
        kieRepository.addKieModule(kieRepository::getDefaultReleaseId);
        KieBuilder kieBuilder = kieServices.newKieBuilder(kieFileSystem());
        kieBuilder.buildAll();
        return kieServices.newKieContainer(kieRepository.getDefaultReleaseId());
    }

    @Bean
    @ConditionalOnMissingBean
    public KieBase kieBase() throws IOException {
        return kieContainer().getKieBase();
    }

    @Bean
    @ConditionalOnMissingBean
    public KModuleBeanFactoryPostProcessor kiePostProcessor() {
        return new KModuleBeanFactoryPostProcessor();
    }
}
</code></pre>
<p>**第六步：创建RuleService类 **</p>
<pre><code class="language-java">package com.example.drools.service;


import com.example.drools.entity.Order;
import org.drools.core.base.RuleNameEqualsAgendaFilter;
import org.drools.core.base.RuleNameStartsWithAgendaFilter;
import org.kie.api.KieBase;
import org.kie.api.runtime.KieSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class RuleService {
    @Autowired
    private KieBase kieBase;

    /**
     * 执行订单金额积分规则
     */
    public Order executeOrderRule(Order order) {
        KieSession kieSession = kieBase.newKieSession();
        kieSession.insert(order);
        kieSession.fireAllRules(new RuleNameStartsWithAgendaFilter(&quot;score_&quot;));
        kieSession.dispose();
        return order;
    }
} 
</code></pre>
<p><strong>第七步：创建OrderController类</strong></p>
<pre><code class="language-java">package com.example.drools.controller;


import com.example.drools.entity.Order;
import com.example.drools.service.RuleService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class OrderController {
    @Autowired
    private RuleService ruleService;

    @GetMapping(&quot;/saveOrder&quot;)
    public Order saveOrder(Order order) {
        System.out.println(&quot;hello,world&quot;);
        return ruleService.executeOrderRule(order);
    }
}
</code></pre>
<p><strong>第八步：新建order.html页面，发送ajax请求(将页面放在src/main/resources/static下，可以在浏览器直接访问，这是springboot默认的静态资源文件夹)</strong></p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;订单页面&lt;/title&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        div {
            margin: auto;
            width: 500px;
        }

        #score {
            color: red;
            font-size: 14px;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;订单金额:&lt;/td&gt;
            &lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;amout&quot; name=&quot;amout&quot;/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;该订单可以累计的积分：&lt;/td&gt;
            &lt;td&gt;&lt;span id=&quot;score&quot;&gt;&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    $(function () {
        $(&quot;#amout&quot;).blur(function () {
            $.ajax({
                url: &quot;/saveOrder&quot;,
                type: &quot;get&quot;,
                data: {&quot;amout&quot;: $(&quot;#amout&quot;).val()},
                dataType: &quot;json&quot;,
                success: function (data) {
                    //设置积分
                    $(&quot;#score&quot;).html(data.score);
                }
            });
        });
    });
&lt;/script&gt;
&lt;/html&gt;
</code></pre>
<p>最终效果: 访问<a href="http://127.0.0.1:8088/order.html">http://127.0.0.1:8088/order.html</a></p>
<figure data-type="image" tabindex="1"><img src="https://fastly.jsdelivr.net/gh/yz0812/mypic@master/202208292246620.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="2"><img src="https://fastly.jsdelivr.net/gh/yz0812/mypic@master/202208292246691.png" alt="" loading="lazy"></figure>

                          </div>
                        </div>
                        <div class="layout-post-social">
                          <div class="item reader">
                            <div id="/post/drools-xue-xi/" class="leancloud-visitors view"
                              data-flag-title="Drools 快速指南">
                              <span class="post-meta-item-text">阅读 </span>
                              <span class="leancloud-visitors-count"></span>
                            </div>
                          </div>
                        </div>

                        <div class="layout-post-navigation">
                          <div class="navigation-list">
                            
                            <div class="post-card row">
                              
                              <div class="card-content col-8 col-md-9">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://yz0812.github.io/post/mapstruct/" class="title">
                                      <h4>MapStruct 快速指南</h4>
                                    </a>
                                  </div>
                                  <div class="inner d-none d-sm-block">
                                    <div class="abstract">
                                      
                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>上一篇</span></div>
                                  <div class="item">2022-09-29</div>
                                </div>
                              </div>
                              <div class="card-thumb col-4 col-md-3">
                                <div class="thumb">
                                  <a href="https://yz0812.github.io/post/mapstruct/"
                                    style="background-image: url('https://fastly.jsdelivr.net/gh/yz0812/mypic@master/img/66.jpg');"></a>
                                </div>
                              </div>
                              
                            </div>

                            <div class="post-card row">
                              
                              <div class="card-content col-8 col-md-9">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://yz0812.github.io/post/docker-xue-xi-zi-liao/" class="title">
                                      <h4> Docker 学习资料</h4>
                                    </a>
                                  </div>
                                  <div class="inner d-none d-sm-block">
                                    <div class="abstract">
                                      
                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>下一篇</span></div>
                                  <div class="item">2022-08-20</div>
                                </div>
                              </div>
                              <div class="card-thumb col-4 col-md-3">
                                <div class="thumb">
                                  <a href="https://yz0812.github.io/post/docker-xue-xi-zi-liao/"
                                    style="background-image: url('https://fastly.jsdelivr.net/gh/yz0812/mypic@master/img/63.jpg');"></a>
                                </div>
                              </div>
                              
                            </div>

                            
                          </div>
                        </div>

                        <div class="layout-comments" id="comments">
                          
                            
                        </div>
                      </div>
                    </div>

                    <div class="col-12 col-lg-2 d-none d-lg-block">
                      <div class="layout-post-sidebar">
                        <div class="layout-sidebar-item">
                          <ul class="markdownIt-TOC">
<li><a href="#drools%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B">Drools使用教程</a>
<ul>
<li><a href="#1-%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E">1. 规则引擎</a></li>
<li><a href="#2-drools%E4%BB%8B%E7%BB%8D">2. Drools介绍</a></li>
<li><a href="#3-demo">3. Demo</a>
<ul>
<li><a href="#31-%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E">3.1 业务场景说明</a></li>
<li><a href="#32-%E5%AF%BC%E5%8C%85">3.2 导包</a></li>
<li><a href="#33-kmodulexml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">3.3 kmodule.xml配置⽂件</a></li>
<li><a href="#34-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BBorder">3.4 创建实体类Order</a></li>
<li><a href="#35-%E5%88%9B%E5%BB%BA%E8%A7%84%E5%88%99%E6%96%87%E4%BB%B6resourcesdroolsrulesscore-rulesdrl">3.5 创建规则⽂件resources/drools/rules/score-rules.drl</a></li>
<li><a href="#36-%E7%BC%96%E5%86%99%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">3.6 编写单元测试</a></li>
</ul>
</li>
<li><a href="#4-drools%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95">4. Drools基础语法</a></li>
<li><a href="#5%E7%BB%93%E6%9E%9C%E9%83%A8%E5%88%86">5.结果部分</a>
<ul>
<li><a href="#51-insert">5.1 insert</a></li>
<li><a href="#52-update">5.2 update</a></li>
<li><a href="#53-retract">5.3 retract</a></li>
</ul>
</li>
<li><a href="#6%E5%B1%9E%E6%80%A7%E9%83%A8%E5%88%86">6.属性部分</a>
<ul>
<li><a href="#61-salience">6.1 salience</a></li>
<li><a href="#62-no-loop">6.2 no-loop</a></li>
<li><a href="#63-date-effective">6.3 date-effective</a></li>
<li><a href="#64-date-expires">6.4 date-expires</a></li>
<li><a href="#65-enabled">6.5 enabled</a></li>
<li><a href="#66-dialect">6.6 dialect</a></li>
<li><a href="#67-activation-group">6.7 activation-group</a></li>
<li><a href="#68-agenda-group">6.8 agenda-group</a></li>
<li><a href="#69-auto-focus">6.9 auto-focus</a></li>
<li><a href="#610-timer">6.10 timer</a></li>
</ul>
</li>
<li><a href="#7-drools%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95">7.  Drools高级语法</a>
<ul>
<li><a href="#71-global%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">7.1 global全局变量</a></li>
<li><a href="#72-query%E6%9F%A5%E8%AF%A2">7.2 query查询</a></li>
<li><a href="#73-function%E5%87%BD%E6%95%B0">7.3 function函数</a></li>
</ul>
</li>
<li><a href="#8spring-boot%E6%95%B4%E5%90%88drools">8.Spring Boot整合Drools</a></li>
</ul>
</li>
</ul>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="layout-totop d-none"><i class="fa fa-angle-up" aria-hidden="true"></i></div>

    	<div class="layout-footer">

		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">
					<div class="footer">
						<div class="row">
							<div class="col-12 col-md-9">
								<div class="footer-copy">
									
									<span>© 2018-05-01 </span>
									<a href="https://yz0812.github.io" title="yz">yz</a>
									<span class="px-2">⋅</span>
									
									
									<div class="footer-icp d-none d-sm-inline-block">
										<span class="px-2">⋅</span>
										
									</div>
								</div>
							</div>
							<div class="col-sm-3 d-none d-md-block">
								<div class="footer-links">
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>

	<script type="text/javascript" src='https://yz0812.github.io/media/scripts/main.js'></script>
	
	<script>
		var _hmt = _hmt || [];
		(function () {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?1bcfcef443c3da9720b8bc3f63856c73";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>
	

  </div>
</body>

</html>